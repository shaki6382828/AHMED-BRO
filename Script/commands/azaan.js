const schedule = require('node-schedule');
const moment = require('moment-timezone');
const chalk = require('chalk');

module.exports.config = {
    name: 'azaan',
    version: '11.0.0',
    hasPermssion: 0,
    credits: 'SIFAT',
    description: 'Automatically sends prayer reminders at scheduled times (BD Time)',
    commandCategory: 'group messenger',
    usages: '[]',
    cooldowns: 3
};

// à¦…à¦¨à§à¦—à§à¦°à¦¹ à¦•à¦°à§‡ à¦¨à¦¿à¦šà§‡à¦° à¦¸à¦®à§Ÿà¦¸à§‚à¦šà§€ à¦ªà§à¦°à¦¤à¦¿à¦¦à¦¿à¦¨ à¦ªà¦°à¦¿à¦¬à¦°à§à¦¤à¦¨ à¦•à¦°à§‡ à¦¨à¦¿à¦¬à§‡à¦¨à¥¤
const messages = [
    { time: '4:30 AM', message: 'à¦†à¦¸-à¦¸à¦¾à¦²à¦¾à¦¤à§ à¦–à¦¾à¦‡à¦°à§à¦® à¦®à¦¿à¦¨à¦¾à¦¨ à¦¨à¦¾à¦‰à¦®à¥¤\nà¦à¦–à¦¨ à¦«à¦œà¦° à¦¨à¦¾à¦®à¦¾à¦œà§‡à¦° à¦¸à¦®à¦¯à¦¼à¥¤ à¦¸à§à¦¨à¦¿à¦—à§à¦§ à¦­à§‹à¦°à§‡à¦° à¦à¦‡ à¦ªà¦¬à¦¿à¦¤à§à¦° à¦®à§à¦¹à§‚à¦°à§à¦¤à§‡ à¦®à¦¹à¦¾à¦¨ à¦†à¦²à§à¦²à¦¾à¦¹à¦° à¦¦à¦°à¦¬à¦¾à¦°à§‡ à¦¸à¦¿à¦œà¦¦à¦¾à¦¹ à¦•à¦°à§‡ à¦¦à¦¿à¦¨à§‡à¦° à¦¸à§‚à¦šà¦¨à¦¾ à¦•à¦°à§à¦¨à¥¤ ðŸ•Œâœ¨' },
    { time: '1:00PM', message: 'à¦•à¦°à§à¦®à¦¬à§à¦¯à¦¸à§à¦¤à¦¤à¦¾à¦° à¦®à¦¾à¦à§‡ à¦à¦–à¦¨ à¦¯à§‹à¦¹à¦°à§‡à¦° à¦¨à¦¾à¦®à¦¾à¦œà§‡à¦° à¦¸à¦®à¦¯à¦¼à¥¤\nà¦•à¦¿à¦›à§à¦•à§à¦·à¦£à§‡à¦° à¦œà¦¨à§à¦¯ à¦¦à§à¦¨à¦¿à¦¯à¦¼à¦¾à¦° à¦•à¦¾à¦œ à¦¥à¦¾à¦®à¦¿à¦¯à¦¼à§‡ à¦†à¦–à§‡à¦°à¦¾à¦¤à§‡à¦° à¦œà¦¨à§à¦¯ à¦ªà§à¦°à¦¸à§à¦¤à§à¦¤à¦¿ à¦¨à¦¿à¦¨à¥¤ à¦†à¦²à§à¦²à¦¾à¦¹ à¦†à¦ªà¦¨à¦¾à¦° à¦ªà§à¦°à¦¤à¦¿ à¦¸à¦¹à¦¾à¦¯à¦¼ à¦¹à§‹à¦¨à¥¤ â˜€ï¸ðŸ•‹' },
    { time: '4:40 PM', message: 'à¦à¦–à¦¨ à¦†à¦¸à¦° à¦¨à¦¾à¦®à¦¾à¦œà§‡à¦° à¦¸à¦®à¦¯à¦¼à¥¤\nà¦¦à¦¿à¦¨à§‡à¦° à¦¶à§‡à¦·à¦­à¦¾à¦—à§‡ à¦†à¦²à§à¦²à¦¾à¦¹à¦° à¦¨à§‡à¦¯à¦¼à¦¾à¦®à¦¤à§‡à¦° à¦¶à§à¦•à¦°à¦¿à¦¯à¦¼à¦¾ à¦†à¦¦à¦¾à¦¯à¦¼ à¦•à¦°à§‡ à¦¨à¦¾à¦®à¦¾à¦œ à¦ªà¦¡à¦¼à§‡ à¦¨à¦¿à¦¨à¥¤ à¦¨à¦¿à¦¶à§à¦šà¦¯à¦¼à¦‡ à¦¤à¦¿à¦¨à¦¿ à¦ªà¦°à¦® à¦•à¦°à§à¦£à¦¾à¦®à¦¯à¦¼à¥¤ ðŸŒ‡ðŸ¤²' },
    { time: '6:20 PM', message: 'à¦¸à§‚à¦°à§à¦¯ à¦…à¦¸à§à¦¤ Ø±ÙØªÙ‡à¦›à§‡, à¦à¦–à¦¨ à¦®à¦¾à¦—à¦°à¦¿à¦¬à§‡à¦° à¦¸à¦®à¦¯à¦¼à¥¤\nà¦¸à¦¾à¦°à¦¾à¦¦à¦¿à¦¨à§‡à¦° à¦¬à§à¦¯à¦¸à§à¦¤à¦¤à¦¾ à¦¶à§‡à¦·à§‡ à¦ªà¦°à¦¿à¦¬à¦¾à¦° à¦¨à¦¿à¦¯à¦¼à§‡ à¦¸à¦®à¦¯à¦¼à¦®à¦¤à§‹ à¦¨à¦¾à¦®à¦¾à¦œ à¦†à¦¦à¦¾à¦¯à¦¼ à¦•à¦°à§à¦¨ à¦à¦¬à¦‚ à¦†à¦²à§à¦²à¦¾à¦¹à¦° à¦•à¦¾à¦›à§‡ à¦¦à§‹à¦¯à¦¼à¦¾ à¦•à¦°à§à¦¨à¥¤ ðŸŒ†ðŸ’–' },
    { time: '7:35 PM', message: 'à¦à¦–à¦¨ à¦à¦¶à¦¾à¦° à¦¨à¦¾à¦®à¦¾à¦œà§‡à¦° à¦¸à¦®à¦¯à¦¼à¥¤\nà¦¦à¦¿à¦¨à§‡à¦° à¦¶à§‡à¦· à¦¨à¦¾à¦®à¦¾à¦œ à¦†à¦¦à¦¾à¦¯à¦¼ à¦•à¦°à§‡ à¦ªà§à¦°à¦¶à¦¾à¦¨à§à¦¤à¦¿à¦° à¦¸à¦¾à¦¥à§‡ à¦†à¦ªà¦¨à¦¾à¦° à¦¦à¦¿à¦¨ à¦¶à§‡à¦· à¦•à¦°à§à¦¨à¥¤ à¦†à¦²à§à¦²à¦¾à¦¹ à¦†à¦®à¦¾à¦¦à§‡à¦° à¦‡à¦¬à¦¾à¦¦à¦¤ à¦•à¦¬à§à¦² à¦•à¦°à§à¦¨à¥¤ ðŸŒ™âœ¨' }
];

module.exports.onLoad = ({ api }) => {
    console.log(chalk.bold.hex("#00c300")("============ NAMAZ REMINDER LOADED (BD TIME) ============"));

    messages.forEach(({ time, message }) => {
        const [hour, minute, period] = time.split(/[: ]/);
        let hour24 = parseInt(hour, 10);
        if (period === 'PM' && hour !== '12') {
            hour24 += 12;
        } else if (period === 'AM' && hour === '12') {
            hour24 = 0;
        }

        const rule = new schedule.RecurrenceRule();
        rule.tz = 'Asia/Dhaka';
        rule.hour = hour24;
        rule.minute = parseInt(minute, 10);

        schedule.scheduleJob(rule, () => {
            if (!global.data?.allThreadID) return;
            global.data.allThreadID.forEach(threadID => {
                api.sendMessage(message, threadID, (error) => {
                    if (error) {
                        console.error(`Failed to send message to ${threadID}:`, error);
                    }
                });
            });
        });

        console.log(chalk.hex("#00FFFF")(`Scheduled (BDT): ${time} => ${message}`));
    });
};

module.exports.run = () => {
    // Main logic is in onLoad
};
